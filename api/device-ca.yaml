openapi: 3.0.0
info:
  title: Trusted device CA certificates management API
  version: 0.0.1
  description: An API for managing a list of Trusted device CA certificates in PEM format. It supports List, Create, Read, Update, and Delete (LCRUD) operations.
  contact:
    name: API Support
    url: https://github.com/fido-device-onboard/go-fdo-server/issues
servers:
  - url: http://localhost/api/v1
    description: Trusted device CA management API
tags:
  - name: Trusted device CA certificates
    description: Operations related to trusted device CA certificates
paths:
  /device-ca:
    get:
      tags:
        - Trusted device CA certificates
      summary: List all trusted device CA certificates
      description: Retrieves a paginated, filterable, and sortable list of all registered trusted device CA certificates.
      operationId: listTrustedDeviceCACerts
      parameters:
        - name: limit
          in: query
          description: The number of items to return per page.
          required: false
          schema:
            type: integer
            default: 20
            minimum: 1
            maximum: 100
        - name: offset
          in: query
          description: The number of items to skip before starting to collect the result set.
          required: false
          schema:
            type: integer
            default: 0
            minimum: 0
        - name: issuer
          in: query
          description: Filters the results by the exact issuer distinguished name.
          required: false
          schema:
            type: string
            example: 'CN=Example CA, O=Example Inc, C=US'
        - name: sortBy
          in: query
          description: Sorts the results by the specified field.
          required: false
          schema:
            type: string
            enum:
              - createdAt
              - notAfter
            default: createdAt
        - name: sortOrder
          in: query
          description: Specifies the sorting order.
          required: false
          schema:
            type: string
            enum:
              - asc
              - desc
            default: asc
      responses:
        '200':
          description: A paginated list of trusted device CA certificates.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TrustedDeviceCACerts'
              examples:
                success:
                  summary: Example of a successful response
                  value:
                    total: 2
                    limit: 20
                    offset: 0
                    data:
                      - id: 'a1b2c3d4-e5f6-7890-1234-567890abcdef'
                        pem: "-----BEGIN CERTIFICATE-----\nMIID... (truncated) ...END CERTIFICATE-----\n"
                        subject: 'CN=trusted.device-ca.one, O=Example Corp, C=US'
                        issuer: 'CN=Example Intermediate CA, O=Example Corp, C=US'
                        notBefore: '2023-01-01T00:00:00Z'
                        notAfter: '2024-01-01T00:00:00Z'
                        createdAt: '2023-05-10T10:30:00Z'
                        updatedAt: '2023-05-10T10:30:00Z'
                      - id: 'b2c3d4e5-f6a7-8901-2345-67890abcdef1'
                        pem: "-----BEGIN CERTIFICATE-----\nMIID... (truncated) ...END CERTIFICATE-----\n"

                        subject: 'CN=trusted.device-ca.two, O=Example Corp, C=US'
                        issuer: 'CN=Example Intermediate CA, O=Example Corp, C=US'
                        notBefore: '2023-02-15T00:00:00Z'
                        notAfter: '2024-02-15T00:00:00Z'
                        createdAt: '2023-06-20T12:00:00Z'
                        updatedAt: '2023-06-20T12:00:00Z'
        '401':
          $ref: './components.yaml#/components/responses/Unauthorized'
        '403':
          $ref: './components.yaml#/components/responses/Forbidden'
        '500':
          $ref: './components.yaml#/components/responses/InternalServerError'
    post:
      tags:
        - Trusted device CA certificates
      summary: Create a new trusted device CA certificate
      description: Uploads a new PEM-encoded certificate for a trusted device CA.
      operationId: createTrustedDeviceCACert
      requestBody:
        description: The new trusted device CA certificate to create.
        required: true
        content:
          application/x-pem-file:
            schema:
              type: string
              format: binary
            examples:
              createCert:
                summary: Example of creating a new certificate
                value: |
                  -----BEGIN CERTIFICATE-----
                  MIID... (a new certificate) ...
                  -----END CERTIFICATE-----
      responses:
        '201':
          description: trusted device CA certificate created successfully.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TrustedDeviceCACert'
              examples:
                createdCert:
                  summary: Example response for a created certificate
                  value:
                    id: 'c3d4e5f6-a7b8-9012-3456-7890abcdef12'
                    pem: "-----BEGIN CERTIFICATE-----\nMIID... (a new certificate) ...END CERTIFICATE-----\n"
                    subject: 'CN=new.trusted.device-ca, O=Example Corp, C=US'
                    issuer: 'CN=Example Intermediate CA, O=Example Corp, C=US'
                    notBefore: '2023-10-01T00:00:00Z'
                    notAfter: '2024-10-01T00:00:00Z'
                    createdAt: '2023-10-27T14:00:00Z'
                    updatedAt: '2023-10-27T14:00:00Z'
        '400':
          $ref: './components.yaml#/components/responses/BadRequest'
        '401':
          $ref: './components.yaml#/components/responses/Unauthorized'
        '403':
          $ref: './components.yaml#/components/responses/Forbidden'
        '500':
          $ref: './components.yaml#/components/responses/InternalServerError'
  /device-ca/{UUID}:
    get:
      tags:
        - Trusted device CA certificates
      summary: Get a trusted device CA certificate by ID in PEM format
      description: Retrieves a specific trusted device CA certificate by its unique ID, returned as a PEM file.
      operationId: getTrustedDeviceCACertByIdAsPem
      parameters:
        - $ref: './components.yaml#/components/parameters/UUID'
      responses:
        '200':
          description: The requested trusted device CA certificate in PEM format.
          content:
            application/x-pem-file:
              schema:
                type: string
                format: binary
                description: The certificate content in PEM format.
              examples:
                getCertPem:
                  summary: Example PEM certificate response
                  value: |
                    -----BEGIN CERTIFICATE-----
                    MIIDzTCCArWgAwIBAgIQC+2PL2fUi... (truncated)
                    -----END CERTIFICATE-----
        '401':
          $ref: './components.yaml#/components/responses/Unauthorized'
        '403':
          $ref: './components.yaml#/components/responses/Forbidden'
        '404':
          $ref: './components.yaml#/components/responses/NotFound'
        '500':
          $ref: './components.yaml#/components/responses/InternalServerError'
    put:
      tags:
        - Trusted device CA certificates
      summary: Update a trusted device CA certificate by ID
      description: Replaces an existing trusted device CA certificate with a new PEM-encoded certificate.
      operationId: updateTrustedDeviceCACert
      parameters:
        - $ref: './components.yaml#/components/parameters/UUID'
      requestBody:
        description: The updated certificate data in PEM format.
        required: true
        content:
          application/x-pem-file:
            schema:
              type: string
              format: binary
              description: The certificate content in PEM format.
            examples:
              updateCertPem:
                summary: Example of updating a certificate (PEM file)
                value: |
                  -----BEGIN CERTIFICATE-----
                  MIID... (an updated certificate) ...
                  -----END CERTIFICATE-----
      responses:
        '200':
          description: trusted device CA certificate updated successfully.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TrustedDeviceCACert'
              examples:
                updatedCert:
                  summary: Example response for an updated certificate
                  value:
                    id: 'a1b2c3d4-e5f6-7890-1234-567890abcdef'
                    pem: "-----BEGIN CERTIFICATE-----\nMIID... (an updated certificate) ...END CERTIFICATE-----\n"
                    subject: 'CN=trusted.device-ca.one.v2, O=Example Corp, C=US'
                    issuer: 'CN=Example Intermediate CA, O=Example Corp, C=US'
                    notBefore: '2023-10-27T00:00:00Z'
                    notAfter: '2024-10-27T00:00:00Z'
                    createdAt: '2023-05-10T10:30:00Z'
                    updatedAt: '2023-10-27T15:00:00Z'
        '400':
          $ref: './components.yaml#/components/responses/BadRequest'
        '401':
          $ref: './components.yaml#/components/responses/Unauthorized'
        '403':
          $ref: './components.yaml#/components/responses/Forbidden'
        '404':
          $ref: './components.yaml#/components/responses/NotFound'
        '500':
          $ref: './components.yaml#/components/responses/InternalServerError'
    delete:
      tags:
        - Trusted device CA certificates
      summary: Delete a trusted device CA certificate by ID
      description: Deletes a specific trusted device CA certificate by its unique ID.
      operationId: deleteTrustedDeviceCACert
      parameters:
        - $ref: './components.yaml#/components/parameters/UUID'
      responses:
        '204':
          description: trusted device CA certificate deleted successfully.
        '401':
          $ref: './components.yaml#/components/responses/Unauthorized'
        '403':
          $ref: './components.yaml#/components/responses/Forbidden'
        '404':
          $ref: './components.yaml#/components/responses/NotFound'
        '500':
          $ref: './components.yaml#/components/responses/InternalServerError'
components:
  $ref: './components.yaml#/components/securitySchemes'
  schemas:
    TrustedDeviceCACerts:
      type: object
      properties:
        total:
          type: integer
          description: Total number of trusted device CA certificates available.
        limit:
          type: integer
          description: The number of items returned in this response.
        offset:
          type: integer
          description: The offset from the beginning of the collection.
        data:
          type: array
          items:
            $ref: '#/components/schemas/TrustedDeviceCACert'
    TrustedDeviceCACert:
      type: object
      properties:
        id:
          type: string
          format: uuid
          description: The unique identifier for the trusted device CA.
        pem:
          type: string
          description: The full certificate content in PEM format.
          format: pem
        subject:
          type: string
          description: The subject distinguished name of the certificate.
        issuer:
          type: string
          description: The issuer distinguished name of the certificate.
        notBefore:
          type: string
          format: date-time
          description: The start date of the certificate's validity period.
        notAfter:
          type: string
          format: date-time
          description: The end date of the certificate's validity period.
        createdAt:
          type: string
          format: date-time
          description: The timestamp when the certificate was added.
        updatedAt:
          type: string
          format: date-time
          description: The timestamp when the certificate was last updated.
